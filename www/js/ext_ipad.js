// Generated by CoffeeScript 1.4.0
(function() {

  Ext.setup({
    tabletStartupScreen: "tablet_startup.png",
    phoneStartupScreen: "phone_startup.png",
    icon: "icon.png",
    glossOnIcon: false,
    onReady: function() {
      var all_entries, carousel1, groupingBase, list;
      Ext.regModel("Entry", {
        fields: ["text", "create_time", "tags", "date", "seconds"]
      });
      all_entries = get_entry();
      window.store = new Ext.data.Store({
        model: "Entry",
        sorters: {
          property: "seconds",
          direction: "DESC"
        },
        getGroupString: function(record) {
          var a, b, week;
          a = record.get("date");
          b = new Date(a);
          week = ['Non', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
          return week[b.getUTCDay()] + ', ' + record.get("date");
        },
        data: all_entries
      });
      groupingBase = {
        itemTpl: "<div class=\"maintext\">{text}</div> <div class=\"timetext\">{create_time}</div>",
        singleSelect: false,
        multiSelect: false,
        grouped: true,
        indexBar: false,
        disableSelection: true,
        /*
              onItemTap: ()->
                console.log("testing item tap")
                  #alert "Disclose more info for " + record.get("firstName")
                  console.log( record.data )
                  window.r_id = record.data.id
                  $("#buttonbar").show()
                  $("#writearea").val(record.get("text"))
                  window.carousel.setActiveItem( 0, 'flip' )
        */

        onItemDisclosure: {
          scope: "test",
          handler: function(record, btn, index) {
            console.log(record.data);
            window.r_id = record.data.id;
            $("#buttonbar").show();
            $("#writearea").val(record.get("text"));
            return window.carousel.setActiveItem(0, 'flip');
          }
        },
        listeners: {
          itemtap: function(list, index, item, e) {
            var record;
            console.log("tapped");
            record = window.list.store.getAt(index);
            window.r_id = record.data.id;
            $("#buttonbar").show();
            $("#writearea").val(record.get("text"));
            return window.carousel.setActiveItem(0, 'flip');
          }
        },
        store: window.store
      };
      list = new Ext.List(Ext.apply(groupingBase, {
        centered: true,
        modal: true
      }));
      window.list = list;
      carousel1 = new Ext.Carousel({
        defaults: {
          cls: "card"
        },
        flex: 3,
        items: [
          {
            html: "<textarea type=\"textarea\" id='writearea' placeholder='Tap and add your entry; Hit return to save'></textarea>\n<div id=\"buttonbar\">\n  <a class=\"button\" onclick=\"window.save_entry()\">Save</a>\n  <a class=\"button\" id=\"rightbutton\" onclick=\"window.delete_entry()\">Delete</a>\n</div>"
          }, list, {
            title: "Tab 3",
            html: "<div class=\"x-list\">\n  <div class=\"x-list-item\">\n    <div class=\"x-list-item-body\">\n      <div class=\"maintext\">\n        <p style=\"color: #fff; padding: 10px\">Sync all your entries across multiple devices by setting up storage on Dropbox.</p>\n        <p style=\"color: #fff; padding: 10px\">First click on authorize and then allow data access on the Dropbox link in the browser. Then click on validate back in the app.</p>\n      </div> \n    </div>\n    <div class=\"x-list-disclosure\"></div>\n  </div>\n  <div class=\"x-list-item\" onclick=\"window.auth()\">\n    <div class=\"x-list-item-body\">\n      <div class=\"maintext\">\n        <p style=\"color: #fff; padding: 10px; text-align: middle\">Authorize</p>\n      </div> \n    </div>\n    <div class=\"x-list-disclosure\"></div>\n  </div>\n  <div class=\"x-list-item\" onclick=\"window.validate()\">\n    <div class=\"x-list-item-body\">\n      <div class=\"maintext\">\n        <p style=\"color: #fff; padding: 10px; text-align: middle\">Validate</p>\n      </div> \n    </div>\n    <div class=\"x-list-disclosure\"></div>\n  </div>\n  <div class=\"x-list-item\" onclick=\"window.sync_entry()\">\n    <div class=\"x-list-item-body\">\n      <div class=\"maintext\">\n        <p style=\"color: #fff; padding: 10px; text-align: middle\">Sync All</p>\n      </div> \n    </div>\n    <div class=\"x-list-disclosure\"></div>\n  </div>                  \n</div>"
          }
        ]
      });
      window.carousel = carousel1;
      carousel1.addListener("cardswitch", function(obj, newCard, oldCard, index, animated) {
        if (index !== 0) {
          if (window.rid !== "") {
            $("#writearea").val("");
          }
          return $("#buttonbar").hide();
        }
      });
      new Ext.Panel({
        fullscreen: true,
        layout: {
          type: "hbox",
          align: "stretch"
        },
        defaults: {
          flex: 3
        },
        items: [
          carousel1, {
            flex: 1,
            id: "ipad_side",
            html: "<div class=\"x-list\">\n  <div class=\"x-list-item\" style=\"background-color: #444\">\n    <div class=\"x-list-item-body\">\n      <div class=\"maintext\">\n        <img id='side_logo' src='img/logo_td.png' style=\"width: 100%\" />\n      </div> \n    </div>\n    <div class=\"x-list-disclosure\"></div>\n  </div>\n  <div class=\"x-list-item\" style=\"background-color: #555\" onclick='window.carousel.setActiveItem( 0, \"fade\" )'>\n    <div class=\"x-list-item-body\">\n      <div class=\"maintext\">\n        <p style=\"color: #fff; padding: 10px\">add entry</p>\n      </div> \n    </div>\n    <div class=\"x-list-disclosure\"></div>\n  </div>\n  <div class=\"x-list-item\" style=\"background-color: #666\" onclick='window.carousel.setActiveItem( 1, \"fade\" )'>\n    <div class=\"x-list-item-body\">\n      <div class=\"maintext\">\n        <p style=\"color: #fff; padding: 10px\">browse entry</p>\n      </div> \n    </div>\n    <div class=\"x-list-disclosure\"></div>\n  </div>\n  <div class=\"x-list-item\" style=\"background-color: #777\" onclick='window.carousel.setActiveItem( 2, \"fade\" )'>\n    <div class=\"x-list-item-body\">\n      <div class=\"maintext\">\n        <p style=\"color: #fff; padding: 10px\">setup sync</p>\n      </div> \n    </div>\n    <div class=\"x-list-disclosure\"></div>\n  </div>                              \n</div>"
          }
        ]
      });
      $("#writearea").keydown(function(e) {
        var keyCode;
        keyCode = e.keyCode || e.which;
        if (keyCode === 13) {
          window.create_new_entry();
          return false;
        }
      });
      return window.auto_sync();
    }
  });

}).call(this);
